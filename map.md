# map

```
          ┌─────────────┐                                                                                                                         
          │    hmap     │                                                                                       ┌─────────┐                       
          ├─────────────┴──────────────────┐           ┌───────────────┐                     ┌─────────────────▶│  bmap   │                       
          │           count int            │           │               │                     │                  ├─────────┴──────────────────────┐
          │                                │           │               ▼                     │                  │    tophash [bucketCnt]uint8    │
          ├────────────────────────────────┤           │    ────────┬─────┐                  │                  │                                │
          │          flags uint8           │           │       ▲    │  0  │                  │                  ├────────────────────────────────┤
          │                                │           │       │    │     │──────────────────┘                  │      keys unsafe.Pointer       │
          ├────────────────────────────────┤           │       │    ├─────┤                                     │                                │
          │            B uint8             │           │       │    │  1  │                                     ├────────────────────────────────┤
          │                                │           │       │    │     │──────────────────┐                  │     values unsafe.Pointer      │
          ├────────────────────────────────┤           │       │    ├─────┤                  │                  │                                │
          │        noverflow uint16        │           │       │    │  2  │                  │                  ├────────────────────────────────┤
          │                                │           │       │    │     │                  │                  │         overflow *bmap         │
          ├────────────────────────────────┤           │       │    ├─────┤                  │                  │                                │
          │          hash0 uint32          │           │       │    │  3  │                  │                  ├─────────┬──────────────────────┘
          │                                │           │       │    │     │                  └─────────────────▶│  bmap   │                       
          ├────────────────────────────────┤           │       │    ├─────┤                                     ├─────────┴──────────────────────┐
          │     buckets unsafe.Pointer     │           │       │    │  4  │                                     │    tophash [bucketCnt]uint8    │
          │                                │───────────┘       │    │     │                                     │                                │
          ├────────────────────────────────┤                        ├─────┤                                     ├────────────────────────────────┤
          │   oldbuckets unsafe.Pointer    │                        │  5  │                                     │      keys unsafe.Pointer       │
          │                                │                        │     │                                     │                                │
          ├────────────────────────────────┤         size = 2 ^ B   ├─────┤                                     ├────────────────────────────────┤
          │       nevacuate uintptr        │                        │  6  │                                     │     values unsafe.Pointer      │
          │                                │                        │     │                                     │                                │
          ├────────────────────────────────┤                   │    ├─────┤                                     ├────────────────────────────────┤
          │        extra *mapextra         │                   │    │  7  │                                     │         overflow *bmap         │
       ┌──│                                │                   │    │     │                                     │                                │
       │  └────────────────────────────────┘                   │    └─────┘                                     └────────────────────────────────┘
       │                                                       │      ....                                                   ........             
       │                                                       │                                                ┌─────────┐                       
       │                                                       │    ┌─────┐                  ┌─────────────────▶│  bmap   │                       
       │                                                       │    │ 61  │                  │                  ├─────────┴──────────────────────┐
       │                                                       │    │     │                  │                  │    tophash [bucketCnt]uint8    │
       ▼                                                       │    ├─────┤                  │                  │                                │
┌─────────────┐                                                │    │ 62  │                  │                  ├────────────────────────────────┤
│  mapextra   │                                                │    │     │──────────────────┘                  │      keys unsafe.Pointer       │
├─────────────┴──────────────┐                                 │    ├─────┤                                     │                                │
│     overflow *[]*bmap      │                                 │    │ 63  │                                     ├────────────────────────────────┤
│                            │                                 ▼    │     │──────────────────┐                  │     values unsafe.Pointer      │
├────────────────────────────┤                              ────────┴─────┘                  │                  │                                │
│    oldoverflow *[]*bmap    │                                                               │                  ├────────────────────────────────┤
│                            │                                                               │                  │         overflow *bmap         │
├────────────────────────────┤                                                               │                  │                                │
│     nextoverflow *bmap     │                                                               │                  ├─────────┬──────────────────────┘
│                            │                                                               └─────────────────▶│  bmap   │                       
└────────────────────────────┘                                                                                  ├─────────┴──────────────────────┐
                                                                                                                │    tophash [bucketCnt]uint8    │
                                                                                                                │                                │
                                                                                                                ├────────────────────────────────┤
                                                                                                                │      keys unsafe.Pointer       │
                                                                                                                │                                │
                                                                                                                ├────────────────────────────────┤
                                                                                                                │     values unsafe.Pointer      │
                                                                                                                │                                │
                                                                                                                ├────────────────────────────────┤
                                                                                                                │         overflow *bmap         │
                                                                                                                │                                │
                                                                                                                └────────────────────────────────┘
```